import l from"path";import O from"fs";function L(r){const t=/^\\\\\?\\/.test(r),n=/[^\u0000-\u0080]+/.test(r);return t||n?r:r.replace(/\\/g,"/")}function U(r,t){for(;;){const n=l.join(r,t);if(O.existsSync(n))return L(n);const e=l.dirname(r);if(e===r)return;r=e}}function z(r,t){t===void 0&&(t=!1);var n=r.length,e=0,i="",c=0,a=16,g=0,s=0,v=0,p=0,f=0;function y(o,b){for(var C=0,m=0;C<o||!b;){var h=r.charCodeAt(e);if(h>=48&&h<=57)m=m*16+h-48;else if(h>=65&&h<=70)m=m*16+h-65+10;else if(h>=97&&h<=102)m=m*16+h-97+10;else break;e++,C++}return C<o&&(m=-1),m}function V(o){e=o,i="",c=0,a=16,f=0}function B(){var o=e;if(r.charCodeAt(e)===48)e++;else for(e++;e<r.length&&T(r.charCodeAt(e));)e++;if(e<r.length&&r.charCodeAt(e)===46)if(e++,e<r.length&&T(r.charCodeAt(e)))for(e++;e<r.length&&T(r.charCodeAt(e));)e++;else return f=3,r.substring(o,e);var b=e;if(e<r.length&&(r.charCodeAt(e)===69||r.charCodeAt(e)===101))if(e++,(e<r.length&&r.charCodeAt(e)===43||r.charCodeAt(e)===45)&&e++,e<r.length&&T(r.charCodeAt(e))){for(e++;e<r.length&&T(r.charCodeAt(e));)e++;b=e}else f=3;return r.substring(o,b)}function S(){for(var o="",b=e;;){if(e>=n){o+=r.substring(b,e),f=2;break}var C=r.charCodeAt(e);if(C===34){o+=r.substring(b,e),e++;break}if(C===92){if(o+=r.substring(b,e),e++,e>=n){f=2;break}var m=r.charCodeAt(e++);switch(m){case 34:o+='"';break;case 92:o+="\\";break;case 47:o+="/";break;case 98:o+="\b";break;case 102:o+="\f";break;case 110:o+=`
`;break;case 114:o+="\r";break;case 116:o+="	";break;case 117:var h=y(4,!0);h>=0?o+=String.fromCharCode(h):f=4;break;default:f=5}b=e;continue}if(C>=0&&C<=31)if(P(C)){o+=r.substring(b,e),f=2;break}else f=6;e++}return o}function A(){if(i="",f=0,c=e,s=g,p=v,e>=n)return c=n,a=17;var o=r.charCodeAt(e);if(W(o)){do e++,i+=String.fromCharCode(o),o=r.charCodeAt(e);while(W(o));return a=15}if(P(o))return e++,i+=String.fromCharCode(o),o===13&&r.charCodeAt(e)===10&&(e++,i+=`
`),g++,v=e,a=14;switch(o){case 123:return e++,a=1;case 125:return e++,a=2;case 91:return e++,a=3;case 93:return e++,a=4;case 58:return e++,a=6;case 44:return e++,a=5;case 34:return e++,i=S(),a=10;case 47:var b=e-1;if(r.charCodeAt(e+1)===47){for(e+=2;e<n&&!P(r.charCodeAt(e));)e++;return i=r.substring(b,e),a=12}if(r.charCodeAt(e+1)===42){e+=2;for(var C=n-1,m=!1;e<C;){var h=r.charCodeAt(e);if(h===42&&r.charCodeAt(e+1)===47){e+=2,m=!0;break}e++,P(h)&&(h===13&&r.charCodeAt(e)===10&&e++,g++,v=e)}return m||(e++,f=1),i=r.substring(b,e),a=13}return i+=String.fromCharCode(o),e++,a=16;case 45:if(i+=String.fromCharCode(o),e++,e===n||!T(r.charCodeAt(e)))return a=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return i+=B(),a=11;default:for(;e<n&&k(o);)e++,o=r.charCodeAt(e);if(c!==e){switch(i=r.substring(c,e),i){case"true":return a=8;case"false":return a=9;case"null":return a=7}return a=16}return i+=String.fromCharCode(o),e++,a=16}}function k(o){if(W(o)||P(o))return!1;switch(o){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}function u(){var o;do o=A();while(o>=12&&o<=15);return o}return{setPosition:V,getPosition:function(){return e},scan:t?u:A,getToken:function(){return a},getTokenValue:function(){return i},getTokenOffset:function(){return c},getTokenLength:function(){return e-c},getTokenStartLine:function(){return s},getTokenStartCharacter:function(){return c-p},getTokenError:function(){return f}}}function W(r){return r===32||r===9||r===11||r===12||r===160||r===5760||r>=8192&&r<=8203||r===8239||r===8287||r===12288||r===65279}function P(r){return r===10||r===13||r===8232||r===8233}function T(r){return r>=48&&r<=57}var N;(function(r){r.DEFAULT={allowTrailingComma:!1}})(N||(N={}));function H(r,t,n){t===void 0&&(t=[]),n===void 0&&(n=N.DEFAULT);var e=null,i=[],c=[];function a(s){Array.isArray(i)?i.push(s):e!==null&&(i[e]=s)}var g={onObjectBegin:function(){var s={};a(s),c.push(i),i=s,e=null},onObjectProperty:function(s){e=s},onObjectEnd:function(){i=c.pop()},onArrayBegin:function(){var s=[];a(s),c.push(i),i=s,e=null},onArrayEnd:function(){i=c.pop()},onLiteralValue:a,onError:function(s,v,p){t.push({error:s,offset:v,length:p})}};return q(r,g,n),i[0]}function q(r,t,n){n===void 0&&(n=N.DEFAULT);var e=z(r,!1);function i(d){return d?function(){return d(e.getTokenOffset(),e.getTokenLength(),e.getTokenStartLine(),e.getTokenStartCharacter())}:function(){return!0}}function c(d){return d?function(w){return d(w,e.getTokenOffset(),e.getTokenLength(),e.getTokenStartLine(),e.getTokenStartCharacter())}:function(){return!0}}var a=i(t.onObjectBegin),g=c(t.onObjectProperty),s=i(t.onObjectEnd),v=i(t.onArrayBegin),p=i(t.onArrayEnd),f=c(t.onLiteralValue),y=c(t.onSeparator),V=i(t.onComment),B=c(t.onError),S=n&&n.disallowComments,A=n&&n.allowTrailingComma;function k(){for(;;){var d=e.scan();switch(e.getTokenError()){case 4:u(14);break;case 5:u(15);break;case 3:u(13);break;case 1:S||u(11);break;case 2:u(12);break;case 6:u(16);break}switch(d){case 12:case 13:S?u(10):V();break;case 16:u(1);break;case 15:case 14:break;default:return d}}}function u(d,w,E){if(w===void 0&&(w=[]),E===void 0&&(E=[]),B(d),w.length+E.length>0)for(var _=e.getToken();_!==17;){if(w.indexOf(_)!==-1){k();break}else if(E.indexOf(_)!==-1)break;_=k()}}function o(d){var w=e.getTokenValue();return d?f(w):g(w),k(),!0}function b(){switch(e.getToken()){case 11:var d=e.getTokenValue(),w=Number(d);isNaN(w)&&(u(2),w=0),f(w);break;case 7:f(null);break;case 8:f(!0);break;case 9:f(!1);break;default:return!1}return k(),!0}function C(){return e.getToken()!==10?(u(3,[],[2,5]),!1):(o(!1),e.getToken()===6?(y(":"),k(),F()||u(4,[],[2,5])):u(5,[],[2,5]),!0)}function m(){a(),k();for(var d=!1;e.getToken()!==2&&e.getToken()!==17;){if(e.getToken()===5){if(d||u(4,[],[]),y(","),k(),e.getToken()===2&&A)break}else d&&u(6,[],[]);C()||u(4,[],[2,5]),d=!0}return s(),e.getToken()!==2?u(7,[2],[]):k(),!0}function h(){v(),k();for(var d=!1;e.getToken()!==4&&e.getToken()!==17;){if(e.getToken()===5){if(d||u(4,[],[]),y(","),k(),e.getToken()===4&&A)break}else d&&u(6,[],[]);F()||u(4,[],[4,5]),d=!0}return p(),e.getToken()!==4?u(8,[4],[]):k(),!0}function F(){switch(e.getToken()){case 3:return h();case 1:return m();case 10:return o(!0);default:return b()}}return k(),e.getToken()===17?n.allowEmptyContent?!0:(u(4,[],[]),!1):F()?(e.getToken()!==17&&u(9,[],[]),!0):(u(4,[],[]),!1)}var G=H;const $=r=>L(/^[./]/.test(r)?r:`./${r}`),D=r=>O.existsSync(r),K=r=>{try{return JSON.parse(r)}catch{}};function Q(r,t){let n=r;if(n===".."&&(n+="/tsconfig.json"),n.startsWith(".")){let e=l.resolve(t,n);if(D(e)&&O.statSync(e).isFile()||!e.endsWith(".json")&&(e+=".json",D(e)))return e}else{let e=U(t,l.join("node_modules",n));if(e){if(O.statSync(e).isDirectory()){const i=l.join(e,"package.json");if(D(i)){const c=K(O.readFileSync(i,"utf8"));c&&"tsconfig"in c?e=l.join(e,c.tsconfig):e=l.join(e,"tsconfig.json")}else e=l.join(e,"tsconfig.json");if(D(e))return e}else if(e.endsWith(".json"))return e}else if(!n.endsWith(".json")&&(n+=".json",e=U(t,l.join("node_modules",n)),e))return e}throw new Error(`File '${r}' not found.`)}var X=Object.defineProperty,Y=Object.defineProperties,Z=Object.getOwnPropertyDescriptors,J=Object.getOwnPropertySymbols,x=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable,M=(r,t,n)=>t in r?X(r,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[t]=n,j=(r,t)=>{for(var n in t||(t={}))x.call(t,n)&&M(r,n,t[n]);if(J)for(var n of J(t))ee.call(t,n)&&M(r,n,t[n]);return r},re=(r,t)=>Y(r,Z(t));function I(r){var t,n;const e=O.realpathSync(r),i=l.dirname(e),c=O.readFileSync(r,"utf8").trim();let a={};if(c&&(a=G(c),!a||typeof a!="object"))throw new SyntaxError(`Failed to parse JSON: ${r}`);if(a.extends){const g=Q(a.extends,i),s=I(g);if(delete s.references,(t=s.compilerOptions)!=null&&t.baseUrl){const{compilerOptions:p}=s;p.baseUrl=l.relative(i,l.join(l.dirname(g),p.baseUrl))||"./"}s.files&&(s.files=s.files.map(p=>l.relative(i,l.join(l.dirname(g),p)))),s.include&&(s.include=s.include.map(p=>l.relative(i,l.join(l.dirname(g),p)))),delete a.extends;const v=re(j(j({},s),a),{compilerOptions:j(j({},s.compilerOptions),a.compilerOptions)});s.watchOptions&&(v.watchOptions=j(j({},s.watchOptions),a.watchOptions)),a=v}if((n=a.compilerOptions)!=null&&n.baseUrl){const{compilerOptions:g}=a;g.baseUrl=$(g.baseUrl)}if(a.files&&(a.files=a.files.map($)),a.include&&(a.include=a.include.map(L)),a.watchOptions){const{watchOptions:g}=a;g.excludeDirectories&&(g.excludeDirectories=g.excludeDirectories.map(s=>L(l.resolve(i,s))))}return a}function ne(r=process.cwd(),t="tsconfig.json"){const n=U(r,t);if(!n)return null;const e=I(n);return{path:n,config:e}}const te=/^\.{1,2}(\/.*)?$/,ae=/\*/g,R=(r,t)=>{const n=r.match(ae);if(n&&n.length>1)throw new Error(t)};function oe(r){if(r.includes("*")){const[t,n]=r.split("*");return{prefix:t,suffix:n}}return r}const ie=({prefix:r,suffix:t},n)=>n.startsWith(r)&&n.endsWith(t);function se(r,t,n){return Object.entries(r).map(([e,i])=>(R(e,`Pattern '${e}' can have at most one '*' character.`),{pattern:oe(e),substitutions:i.map(c=>{if(R(c,`Substitution '${c}' in pattern '${e}' can have at most one '*' character.`),!c.startsWith("./")&&!t)throw new Error("Non-relative paths are not allowed when 'baseUrl' is not set. Did you forget a leading './'?");return l.join(n,c)})}))}function ce(r){if(!r.config.compilerOptions)return null;const{baseUrl:t,paths:n}=r.config.compilerOptions;if(!t&&!n)return null;const e=l.resolve(l.dirname(r.path),t||"."),i=n?se(n,t,e):[];return function(a){if(te.test(a))return[];const g=[];for(const f of i){if(f.pattern===a)return f.substitutions;typeof f.pattern!="string"&&g.push(f)}let s,v=-1;for(const f of g)ie(f.pattern,a)&&f.pattern.prefix.length>v&&(v=f.pattern.prefix.length,s=f);if(!s)return t?[l.join(e,a)]:[];const p=a.slice(s.pattern.prefix.length,a.length-s.pattern.suffix.length);return s.substitutions.map(f=>f.replace("*",p))}}export{ce as createPathsMatcher,ne as getTsconfig};
